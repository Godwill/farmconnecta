<!DOCTYPE html>
<html>

<head>

  <% include ../views/partials/head %>

</head>

<body>

<% include ../views/partials/nav %>

<script type="text/javascript" src="http://jquery.offput.ca/js/jquery.timers.js"></script>
<script type="text/javascript">

  $(document).ready(function(){

//    $(document).everyTime(1000, load);

    function load() {
      $.ajax({
        url: "http://localhost/api/listings",
        error: function(){
          console.log('An error occurred');
        },
        success: function(){
          $('#listings').append(data + '<br />');
        },
        timeout: 3000 // sets timeout to 3 seconds
      });
    }

  });

</script>

<!-- Page Contents -->
<div class="pusher">
  <div class="ui inverted vertical masthead center aligned segment" style="min-height: 100px;">

    <div class="ui container">
      <div class="ui large secondary inverted pointing menu">
        <a class="toc item">
          <i class="sidebar icon"></i>
        </a>
        <a class="active item">Home</a>
        <a class="item" href="/about">About</a>
        <a class="item" href="/listings">Listings</a>
        <div class="right item">
          <a class="ui inverted button" href="/login">Log in</a>
        </div>
      </div>
    </div>

  </div>

  <div class="ui vertical centered stripe segment">
    <div class="ui text container">
      <h3 class="ui header">Latest Listings</h3>

      <div id="listings">
        <% for(var i=0; i<listings.length; i++) {%>
        <div class="ui ignored info message">
          <h3><%= listings[i].sender %>
            <span class="time-ago">
              <%= moment(listings[i].date).fromNow();%>
            </span></h3>
          <p><%= listings[i].message %></p>
        </div>
        <% } %>
      </div>

    </div>
  </div>

  <% include ../views/partials/footer %>

</div>

</body>

</html>